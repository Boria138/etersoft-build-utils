#!/bin/bash
# 2010 Etersoft www.etersoft.ru
# Author: Vitaly Lipatov <lav@etersoft.ru>
# Public domain

which xdg-open 2>/dev/null >/dev/null && BROWSER=xdg-open

# (command from perl-libwww)
which GET &>/dev/null && GET=GET || GET=false
which rsync &>/dev/null && RSYNC=rsync || GET=false

download_url()
{
	# use wget with try=1 and timeout = 30 sec
	which wget >/dev/null || fatal "Can't download, wget command is missed"

	# do not download if already exists...
	[ -r "$(basename "$1")" ] && { echo "skipping $1, already exists..."; return; }

	# NOTE: disable cert checking
	a= wget --no-check-certificate -c -t 1 -T 30 "$1"
	local RET=$?

	# HACK: wget replaced %20 with space after download
	local NAME=$(basename $1)
	local SPACEDNAME=$(basename $1 | sed -e "s/%20/ /g")
	[ "$SPACEDNAME" != "$NAME" ] && mv -f "$SPACEDNAME" "$NAME"
	return $RET
}

check_url()
{
	$GET -d "$1"
}

check_rsync()
{
	[ -n "$1" ] || return 1
	$RSYNC -n "$1" >/dev/null 2>&1
}
