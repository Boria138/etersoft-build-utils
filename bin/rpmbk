#!/bin/sh
# 2012 (c) Etersoft www.etersoft.ru
# Author: Vitaly Lipatov <lav@etersoft.ru>
# Public domain
#
# Собирает пакет из текущего репозитория в Korinf для указанной системы
# rpmbk Система/Версия [спек]

# load common functions, compatible with local and installed script
. `dirname $0`/../share/eterbuild/functions/common
load_mod spec git

if [ "$1" = "-h" ] || [ "$1" = "---help" ] ; then
	echog "rpmbk (Build Korinf) - build package from current repo in Korinf"
	echog "Usage: rpmbk [Distro/Version] [spec]"
	exit 0
fi

DISTROVER="$1"
shift
SPEC="$1"

# TODO: Allow build to common place (use rpmpub?)
#BUILDDIR=$TMPDIR/korinf
BUILDDIR=$RPMDIR/KORINF
export ETERDESTSRPM=$BUILDDIR/sources
mkdir -p $ETERDESTSRPM

test -f "$SPEC" || SPEC=$(get_gear_spec)
build_rpms_name $SPEC
BUILDNAME=$BASENAME

docmd $ETERBUILDBIN/rpmbs || fatal "Can't build SRPMS"
docmd korinf $DISTROVER $BUILDNAME $ETERDESTSRPM
